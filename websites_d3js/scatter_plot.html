<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <title>Test for d3.js</title>
    <script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="/websites_d3js/js/bootstrap.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"
       charset="utf-8"></script>
    <style type="text/CSS">
      label {
        display: inline-block;
        width: 240px;
        text-align: right
      }
      .axis path, .axis line {
          fill: none;
          stroke: black;
          shape-rendering: crispEdges;
      }
      .axis text {
          font-family: sans-serif;
          font-size: 11px;
      }
    </style>
  </head>
  <body>
      <form>
        <label for="datasets">Datasets: </label>
        <select id="datasets">
          <option value="iris">iris</option>
          <option value="salinity">salinity</option>
          <option value="cars">cars</option>
        </select>
      </form>
      <form>
        <label for="xAxisVar">Variable of X axis: </label>
        <select id="xAxisVar">
        </select>
      </form>
      <form>
        <label for="yAxisVar">Variable of Y axis: </label>
        <select id="yAxisVar">
        </select>
      </form>
    <script>
      var dataset, varNames, xValue, yValue, xScale, yScale, xAxis, yAxis;
      var w = 500, h = 500, padding = 30;
      var colorName = ["red", "lime", "gold",
        "cyan", "indigo", "orangeRed", "springGreen", "peru", "paleVioletRed"]

      d3.select("#datasets").on("change", function() {
        alert("Now the dataset is changing to " + this.value + ".");
        update(this.value);
      });
      update("iris");

      d3.select("#xAxisVar").on("change", function() {
        xValue = [];
        for (i = 0; i < dataset.length; i++)
        {
          xValue.push(dataset[i][this.value]);
        }
        updateGraph(xValue, yValue);
      });
      d3.select("#yAxisVar").on("change", function() {
        yValue = [];
        for (i = 0; i < dataset.length; i++)
        {
          yValue.push(dataset[i][this.value]);
        }
        updateGraph(xValue, yValue);
      });

      function update(datasetName) {
        dataPath = "/websites_d3js/datasets/" + datasetName + ".csv";
        d3.csv(dataPath)
          .get(function(error, data) {
            if (error) return console.warn(error);
            dataset = data;
            varNames = Object.keys(dataset[0]);
            if (datasetName == "iris")
              varNames.pop();
            updateXAsixMenu(varNames);
            updateYAsixMenu(varNames);
            xValue = [];
            yValue = [];
            for (i = 0; i < dataset.length; i++)
            {
              xValue.push(dataset[i][varNames[0]]);
              yValue.push(dataset[i][varNames[0]]);
            }
            updateGraph(xValue, yValue);
          });
      }
      function updateXAsixMenu(varNames) {
        var menu = d3.select("#xAxisVar");
        menu.selectAll("option").remove();
        menu.selectAll("option")
          .data(varNames).enter()
          .append("option")
          .attr("value", function(d){return d})
          .text(function(d){return d})
      }
      function updateYAsixMenu(varNames) {
        var menu = d3.select("#yAxisVar");
        menu.selectAll("option").remove();
        menu.selectAll("option")
          .data(varNames).enter()
          .append("option")
          .attr("value", function(d){return d})
          .text(function(d){return d})
      }
      function updateGraph(x, y) {
        d3.select("body").selectAll("svg").remove();
        var scatterPlot = d3.select("body").append("svg")
          .attr("width", w).attr("height", h);
        xScale = d3.scale.linear()
          .domain([d3.min(x, function(d) {return d;}), d3.max(x, function(d) {return parseFloat(d);})])
          .range([padding, w-padding*2]);
        xAxis = d3.svg.axis().scale(xScale).orient("bottom");
        yScale = d3.scale.linear()
          .domain([d3.min(y, function(d) {return d;}), d3.max(y, function(d) {return parseFloat(d);})])
          .range([h-padding, padding]);
        yAxis = d3.svg.axis().scale(yScale).orient("left");
        scatterPlot.selectAll("circle")
          .data(x).enter().append("circle")
           .attr("cx", function(d) {
             return xScale(d);
           }).attr("r", 3)
           .attr("fill", "transparent")
           .attr("stroke", colorName[0])
           .attr("stroke-width", 2)
           .attr("opacity", 0.6);
        scatterPlot.selectAll("circle")
          .attr("cy", function(d, i) {
            return yScale(y[i]);
          });
        scatterPlot.append("g").attr("class", "axis")
           .attr("transform", "translate(0," + (h - padding) + ")")
           .call(xAxis);
        scatterPlot.append("g").attr("class", "axis")
           .attr("transform", "translate(" + padding + ",0)")
           .call(yAxis);
      }
      if(!Object.keys) Object.keys = function(o){
         if (o !== Object(o))
            throw new TypeError('Object.keys called on non-object');
         var ret=[],p;
         for(p in o) if(Object.prototype.hasOwnProperty.call(o,p)) ret.push(p);
         return ret;
      }
    </script>
  </body>
</html>
