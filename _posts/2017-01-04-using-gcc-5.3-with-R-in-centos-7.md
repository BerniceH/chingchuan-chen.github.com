---
layout: post
title: "Using gcc 5.3 with R in CentOS 7"
---

只是記錄一下，方便日後check

``` bash
# install devtoolset-4 to get gcc-5.3
sudo yum install centos-release-scl
sudo yum-config-manager --enable rhel-server-rhscl-7-rpms
sudo yum install -y devtoolset-4 --exclude=devtoolset-4-4.1-3.el7,devtoolset-4-ide-4.1-3.el7
sudo yum update -y

# enable usage of gcc-5.3
sudo tee -a /etc/profile << EOF
scl enable devtoolset-4 bash
EOF
source /etc/profile

# install R from EPEL (default BLAS is openblas)
wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
sudo yum install epel-release-latest-7.noarch.rpm
sudo yum install -y R R-devel R-java libxml2-devel libxml2-static tcl tcl-devel tk tk-devel libtiff-static libtiff-devel libjpeg-turbo-devel libpng12-devel cairo-tools libicu-devel openssl-devel libcurl-devel freeglut readline-static readline-devel cyrus-sasl-devel

# install microsoft R open (default BLAS is MKL)
wget https://mran.microsoft.com/install/mro/3.3.2/microsoft-r-open-3.3.2.tar.gz
tar zxvf microsoft-r-open-3.3.2.tar.gz
sudo yum install microsoft-r-open/rpm/microsoft-r-open-*

# remove R from EPEL, and use microsoft R open
sudo rm -rf /usr/lib64/R
sudo cp -r /usr/lib64/microsoft-r/3.3/lib64/R /usr/lib64
# let user access library dir (not to use personal library)
sudo chmod 777 /usr/lib64/R/library

# config R java env
sudo R CMD javareconf
# check Java work well
# (fail installation indicate configuration of java is wrong)
Rscript -e "install.packages('rJava')"
# check g++ work well
# (fail installation indicate configuration of g++ is wrong)
Rscript -e "install.packages('Rcpp')"
# make C++11 enable
sudo sed -i -e 's/CXX1X =/CXX1X = g++/g' /usr/lib64/R/etc/Makeconf
sudo sed -i -e 's/CXX1XFLAGS =/CXX1XFLAGS = -DU_STATIC_IMPLEMENTATIN -O2 -g $(LTO)/g' /usr/lib64/R/etc/Makeconf
sudo sed -i -e 's/CXX1XPICFLAGS =/CXX1XPICFLAGS = -fpic/g' /usr/lib64/R/etc/Makeconf
sudo sed -i -e 's/CXX1XSTD =/CXX1XSTD = -std=c++11/g' /usr/lib64/R/etc/Makeconf
# check g++ with CXX1X work well
# (fail installation indicate configuration of g++ with CXX1X is wrong)
Rscript -e "install.packages('RcppMLPACK')"

## install rstudio-server
wget https://download2.rstudio.org/rstudio-server-rhel-1.0.136-x86_64.rpm
sudo yum install --nogpgcheck rstudio-server-rhel-1.0.136-x86_64.rpm

# let user not to use personal library
sudo tee -a /etc/rstudio/ << EOF
r-libs-user=/usr/lib64/R/library
EOF

# start rstudio-server
sudo systemctl enable rstudio-server
sudo systemctl start rstudio-server

# open firewall
sudo firewall-cmd --zone=public --add-port=8787/tcp --permanent
sudo firewall-cmd --reload
```
